{
  "schema_version": "0.0.3",
  "entities": [
    {
      "name": "item",
      "fields": [
        {
          "name": "item_code",
          "type": "string",
          "constraints": ["NOT_NULL"]
        },
        {
          "name": "name",
          "type": "string",
          "constraints": ["NOT_NULL"]
        }
      ]
    },
    {
      "name": "order",
      "fields": [
        {
          "name": "order_id",
          "type": "string",
          "constraints": ["NOT_NULL"]
        },
        {
          "name": "items",
          "type": "list<{ref:entities#item}>",
          "constraints": ["NOT_NULL"]
        }
      ]
    }
  ],
  "events": [
    {
      "name": "order_created",
      "entity": "{ref:entities#order}",
      "fields": [
        {
          "name": "order_id",
          "type": "string"
        },
        {
          "name": "customer_id",
          "type": "string"
        }
      ]
    },
    {
      "name": "order_validated",
      "entity": "{ref:entities#order}",
      "fields": [
        {
          "name": "order_id",
          "type": "string"
        },
        {
          "name": "status",
          "type": "string"
        }
      ]
    },
    {
      "name": "order_accepted",
      "entity": "{ref:entities#order}",
      "fields": [
        {
          "name": "order_id",
          "type": "string"
        }
      ]
    },
    {
      "name": "order_rejected",
      "entity": "{ref:entities#order}",
      "fields": [
        {
          "name": "order_id",
          "type": "string"
        }
      ]
    }
  ],
  "requests": [
    {
      "name": "create_order",
      "fields": [
        {
          "name": "customer_id",
          "type": "string"
        }
      ]
    }
  ],
  "responses": [
    {
      "name": "order_accepted",
      "fields": [
        {
          "name": "order_id",
          "type": "string"
        }
      ]
    },
    {
      "name": "order_rejected",
      "fields": [
        {
          "name": "order_id",
          "type": "string"
        },
        {
          "name": "message",
          "type": "string"
        }
      ]
    }
  ],
  "contracts": [
    {
      "name": "create_order",
      "description": "creates an order in pending state",
      "entity": "{ref:entities#order}",
      "type": "COMMAND",
      "consumes": "{ref:requests#create_order}",
      "produces": {
        "on_success": ["{ref:events#order_created}"],
        "on_failure": []
      }
    },
    {
      "name": "validate_order",
      "description": "check if the order is valid",
      "entity": "{ref:entities#order}",
      "type": "EVENT",
      "consumes": "{ref:events#order_created}",
      "produces": {
        "on_success": ["{ref:events#order_validated}"],
        "on_failure": []
      }
    },
    {
      "name": "finalize_order",
      "description": "complete creation of order",
      "entity": "{ref:entities#order}",
      "type": "EVENT",
      "consumes": "{ref:events#order_validated}",
      "produces": {
        "on_success": ["{ref:events#order_accepted}", "{ref:responses#order_accepted}"],
        "on_failure": ["{ref:events#order_rejected}", "{ref:responses#order_rejected}"]
      }
    }
  ]
}